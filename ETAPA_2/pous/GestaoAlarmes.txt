FUNCTION_BLOCK GestaoAlarmes
VAR_INPUT
    TRANSPORTADOR_ENTRADA_ON: BOOL;
    TRANSPORTADOR_SAIDA_ON: BOOL;
    VENTILACAO_SILO1: BOOL;
    VENTILACAO_SILO2: BOOL;
    ALIMENTADOR_MOEGA1_ON: BOOL;
    ALIMENTADOR_MOEGA2_ON: BOOL;
    PESO_TRANSPORTADOR_ENTRADA: REAL;
    PESO_TRANSPORTADOR_SAIDA: REAL;
    PESO_MOEGA: REAL;
    SENSOR_GRAO_ALIMENTADOR_MOEGA1: BOOL;
    SENSOR_GRAO_ALIMENTADOR_MOEGA2: BOOL;
    CAMINHAO_POSICIONADO: BOOL;
    PESO_SILO1: REAL;
    PESO_SILO2: REAL;
END_VAR

VAR_OUTPUT
    ALARME_TRANSPORTADOR_ENTRADA: BOOL;
    ALARME_TRANSPORTADOR_SAIDA: BOOL;
    ALARME_VENTILACAO_SILO1: BOOL;
    ALARME_VENTILACAO_SILO2: BOOL;
    ALARME_ALIMENTADOR_MOEGA1: BOOL;
    ALARME_ALIMENTADOR_MOEGA2: BOOL;
    ALARME_ALIMENTADOR_SAIDA: BOOL;
    ALARME_MOEGA: BOOL;
    ALARME_NIVEL_BAIXO_SILO1: BOOL;
    ALARME_NIVEL_BAIXO_SILO2: BOOL;
    ALARME_NIVEL_ALTO_SILO1: BOOL;
    ALARME_NIVEL_ALTO_SILO2: BOOL;
END_VAR

VAR
    tempo_transportador_entrada: TIME;
    tempo_transportador_saida: TIME;
    tempo_alimentador_moega1: TIME;
    tempo_alimentador_moega2: TIME;
    inicio_transportador_entrada: TIME;
    inicio_transportador_saida: TIME;
    inicio_alimentador_moega1: TIME;
    inicio_alimentador_moega2: TIME;
END_VAR
IF NOT TRANSPORTADOR_ENTRADA_ON THEN
    inicio_transportador_entrada := TIME();
    ALARME_TRANSPORTADOR_ENTRADA := FALSE;
ELSE
    tempo_transportador_entrada := TIME() - inicio_transportador_entrada;
    IF (tempo_transportador_entrada >= T#5S) AND (PESO_TRANSPORTADOR_ENTRADA = 0) THEN
        ALARME_TRANSPORTADOR_ENTRADA := TRUE;
    END_IF
END_IF

IF NOT TRANSPORTADOR_SAIDA_ON THEN
    inicio_transportador_saida := TIME();
    ALARME_TRANSPORTADOR_SAIDA := FALSE;
ELSE
    tempo_transportador_saida := TIME() - inicio_transportador_saida;
    IF (tempo_transportador_saida >= T#5S) AND (PESO_TRANSPORTADOR_SAIDA = 0) THEN
        ALARME_TRANSPORTADOR_SAIDA := TRUE;
    END_IF
    IF (TRANSPORTADOR_SAIDA_ON) AND (NOT ALIMENTADOR_SAIDA_ON) THEN
        ALARME_TRANSPORTADOR_SAIDA := TRUE;
    END_IF
END_IF

IF (ALIMENTADOR_SAIDA_ON AND NOT CAMINHAO_POSICIONADO) THEN
   ALARME_ALIMENTADOR_SAIDA := TRUE;
ELSE
   ALARME_ALIMENTADOR_SAIDA := FALSE;
END_IF

IF (NOT TRANSPORTADOR_SAIDA_ON) AND (PESO_MOEGA > 0) THEN
    ALARME_MOEGA := TRUE;
ELSE
    ALARME_MOEGA := FALSE;
END_IF

IF ALIMENTADOR_MOEGA1_ON THEN
    IF NOT SENSOR_ALIMENTADOR_MOEGA1 THEN
        inicio_alimentador_moega1 := TIME();
        tempo_alimentador_moega1 := TIME() - inicio_alimentador_moega1;
        IF tempo_alimentador_moega1 >= T#5S THEN
            ALARME_ALIMENTADOR_MOEGA1 := TRUE;
        END_IF
    ELSE
        ALARME_ALIMENTADOR_MOEGA1 := FALSE;
    END_IF
ELSE
    inicio_alimentador_moega1 := TIME();
END_IF

IF ALIMENTADOR_MOEGA2_ON THEN
    IF NOT SENSOR_ALIMENTADOR_MOEGA2 THEN
        inicio_alimentador_moega2 := TIME();
        tempo_alimentador_moega2 := TIME() - inicio_alimentador_moega2;
        IF tempo_alimentador_moega2 >= T#5S THEN
            ALARME_ALIMENTADOR_MOEGA2 := TRUE;
        END_IF
    ELSE
        ALARME_ALIMENTADOR_MOEGA2 := FALSE;
    END_IF
ELSE
    inicio_alimentador_moega2 := TIME();
END_IF

IF PESO_SILO1 < 100 THEN
    NIVEL_BAIXO_SILO1 := TRUE;
ELSE
    NIVEL_BAIXO_SILO1 := FALSE;
END_IF

IF PESO_SILO2 < 100 THEN
    NIVEL_BAIXO_SILO2 := TRUE;
ELSE
    NIVEL_BAIXO_SILO2 := FALSE;
END_IF

IF PESO_SILO1 > 2400 THEN
    NIVEL_ALTO_SILO1 := TRUE;
ELSE
    NIVEL_ALTO_SILO1 := FALSE;
END_IF

IF PESO_SILO2 > 2400 THEN
    NIVEL_ALTO_SILO2 := TRUE;
ELSE
    NIVEL_ALTO_SILO2 := FALSE;
END_IF